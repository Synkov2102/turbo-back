# Настройка прокси для парсинга

Для повышения незаметности и обхода блокировок IP можно использовать прокси-серверы.

## Формат конфигурации

Прокси настраиваются через переменные окружения в файле `.env`:

### Один прокси

```env
PROXY=http://username:password@proxy.example.com:8080
```

или без аутентификации:

```env
PROXY=http://proxy.example.com:8080
```

### Несколько прокси (ротация)

```env
PROXY_LIST=http://proxy1.example.com:8080,http://proxy2.example.com:8080,http://username:password@proxy3.example.com:3128
```

## Поддерживаемые протоколы

- `http://` - HTTP прокси
- `https://` - HTTPS прокси
- `socks5://` - SOCKS5 прокси (если поддерживается Puppeteer)

## Примеры конфигурации

### Пример 1: Один HTTP прокси с аутентификацией

```env
PROXY=http://user123:pass456@192.168.1.100:8080
```

### Пример 2: Несколько прокси для ротации

```env
PROXY_LIST=http://proxy1.com:8080,http://proxy2.com:8080,http://proxy3.com:8080
```

### Пример 3: SOCKS5 прокси

```env
PROXY=socks5://user:pass@proxy.example.com:1080
```

## Как это работает

1. **Автоматическая ротация**: При каждом создании браузера используется следующий прокси из списка (round-robin)
2. **Аутентификация**: Если прокси требует логин/пароль, они автоматически передаются при подключении
3. **Fallback**: Если прокси не настроены, браузер работает без прокси

## Логирование

При запуске приложения вы увидите в логах:

```
[BrowserHelper] Loaded 3 proxy server(s)
```

При использовании прокси:

```
[BrowserHelper] Using proxy: http://***:***@proxy.example.com:8080
```

## Требования к прокси для парсинга Avito и Auto.ru

### Типы прокси

#### ✅ Рекомендуемые типы:

1. **Резидентные (Residential) прокси**
   - **Плюсы**: Выглядят как обычные домашние IP-адреса, очень сложно обнаружить
   - **Минусы**: Дороже, могут быть медленнее
   - **Использование**: Для серьезного парсинга с большими объемами

2. **Дата-центровые (Datacenter) прокси**
   - **Плюсы**: Быстрые, дешевые, стабильные
   - **Минусы**: Легче обнаружить, могут быть заблокированы
   - **Использование**: Для небольших объемов или тестирования

3. **Мобильные прокси**
   - **Плюсы**: Очень сложно обнаружить, высокая анонимность
   - **Минусы**: Самые дорогие, могут быть медленными
   - **Использование**: Для критически важных задач

### Геолокация

**Для Avito и Auto.ru критически важно использовать российские прокси:**

- IP-адреса должны быть из России (RU)
- Это снижает вероятность блокировок
- Сайты могут показывать другой контент для иностранных IP

### Технические требования

1. **Протоколы**:
   - HTTP/HTTPS прокси (обязательно)
   - SOCKS5 (опционально, если поддерживается)

2. **Скорость**:
   - Минимум 1-2 Мбит/с на прокси
   - Низкая задержка (< 200ms)
   - Стабильное соединение без обрывов

3. **Анонимность**:
   - Высокая анонимность (Elite/High Anonymous)
   - Не должны передавать реальный IP клиента
   - Не должны добавлять заголовки `X-Forwarded-For` с вашим IP

4. **Ротация**:
   - Автоматическая ротация IP (желательно)
   - Или используйте несколько прокси в `PROXY_LIST`

### Рекомендуемые провайдеры

#### Для резидентных прокси:

- **Bright Data (Luminati)** - дорого, но очень качественно
- **Smartproxy** - хороший баланс цена/качество
- **Oxylabs** - надежные, российские IP доступны
- **IPRoyal** - бюджетный вариант

#### Для дата-центровых прокси:

- **Proxy-Cheap** - дешевые, российские IP
- **Proxy6** - популярный российский провайдер
- **ProxyLine** - хорошая скорость

### Настройка для России

При выборе прокси убедитесь, что:

- ✅ Прокси находятся в России (геолокация RU)
- ✅ Поддерживают HTTP/HTTPS протоколы
- ✅ Имеют хорошую скорость и стабильность
- ✅ Поддерживают аутентификацию (если требуется)

### Примеры конфигурации

#### Вариант 1: Один резидентный прокси

```env
PROXY=http://username:password@residential-proxy.ru:8080
```

#### Вариант 2: Несколько дата-центровых прокси (ротация)

```env
PROXY_LIST=http://proxy1.ru:8080,http://proxy2.ru:8080,http://proxy3.ru:8080
```

#### Вариант 3: Смешанный подход (резидентные + дата-центровые)

```env
PROXY_LIST=http://residential1.ru:8080,http://datacenter1.ru:3128,http://residential2.ru:8080
```

### Рекомендации по использованию

1. **Начните с малого**: Используйте 1-2 прокси для тестирования
2. **Мониторьте блокировки**: Следите за логами на предмет блокировок IP
3. **Ротация**: Используйте несколько прокси для распределения нагрузки
4. **Задержки**: Система автоматически добавляет случайные задержки между запросами
5. **Объем**: Не превышайте разумные лимиты запросов на один прокси

### Стоимость

- **Резидентные**: $50-200+ за месяц (зависит от трафика)
- **Дата-центровые**: $10-50 за месяц
- **Мобильные**: $100-300+ за месяц

### Отключение прокси

Чтобы временно отключить прокси, просто удалите или закомментируйте переменные `PROXY` или `PROXY_LIST` в `.env` файле.
